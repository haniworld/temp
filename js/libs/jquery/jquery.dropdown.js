// Generated by CoffeeScript 1.7.1
(function($) {
  var Dropdown, closeAll, openedDropdowns;
  openedDropdowns = [];

  Dropdown = function(element, options){
    var obj = {};
    obj.options =  {
      animate: false,
      closeOnScroll: true
    };
    obj.$elem = $(element);

    $.extend(obj, {
      _create: function() {
        var target;
        target = this.$elem.data('target') || this.$elem.attr('href');
        this.paneEl = $(target);
        this.$elem.on('click.dropdown touchstart.dropdown', $.proxy(this.toggle, this));
        this.paneEl.on('click.dropdown touchstart.dropdown', function(event) {
          return event.stopPropagation();
        });

        // if (this.options.closeOnScroll) {
        //   $(window).on('scroll.dropdown', $.proxy(this.close, this));
        // }
      },
      toggle: function(event) {
        if (event) {
          event.stopPropagation();
          event.preventDefault();
        }
        if (this.$elem.hasClass('open')) {
          this.close();
        } else {
          this.open();
        }
      },
      open: function() {
        if (this.isOpen) {
          return;
        }
        //closeAll();
        openedDropdowns.push(this);
        this.isOpen = true;
        this.$elem.addClass('open');
        this.paneEl.addClass('open');
        this.paneEl.animate({
          height: 'show'
        });
        // if (!this.options.animate) {
        //   this.paneEl.show();
        // } else {
        //   this.paneEl.stop().show().css({
        //     top: 0,
        //     opacity: 0
        //   }).animate({
        //     top: '100%',
        //     opacity: 1
        //   }, 100);
        // }
      },
      close: function() {
        if (!this.isOpen) {
          return;
        }
        this.isOpen = false;
        this.$elem.removeClass('open');
        this.paneEl.removeClass('open');
        this.paneEl.animate({
          height: 'hide'
        });
      },
      destroy: function() {
        $('html').off('.dropdown');
        this.$elem.off('.dropdown');
        this.paneEl.off('.dropdown');
        $(window).off('.dropdown');
      }
    });

    var api = null;
    api = obj.$elem.data("dropdown");
    if (api) {
      return api[options]();
    }
    else {
      obj._create();
    }

    obj.$elem.data("dropdown", obj);
  };

  closeAll = function(event) {
    var dropdown, _i, _len;
    for (_i = 0, _len = openedDropdowns.length; _i < _len; _i++) {
      dropdown = openedDropdowns[_i];
      dropdown.close();
    }
  };
  //$('html').on('click.dropdown touchstart.dropdown', closeAll);
  //$.widget('nckh.dropdown', Dropdown);
  $.fn.dropdown = function(options) {
    return this.each(function(index, element) {
      return Dropdown(element, options);
    });
  };
  if (typeof define === 'function') {
    return define('jquery.dropdown', ['jquery'], function() {
      return $;
    });
  }
}).call(this, jQuery);
